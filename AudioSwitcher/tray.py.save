#!/usr/bin/python
import os
import gi
gi.require_version("Gtk", "3.0")
gi.require_version("AppIndicator3", "0.1")
#import gtk.gdk as gdk
from gi.repository import Gtk as gtk, AppIndicator3 as appindicator, Gdk as gdk
from os.path import expanduser

indicator = 0
home = expanduser("~")
path = "{}/AudioSwitcher".format(home)

def main():
    icon ="{}/headphones.png".format(path)

    global indicator

    indicator = appindicator.Indicator.new("AudioSwitcher", icon,
    appindicator.IndicatorCategory.APPLICATION_STATUS)
    
    set_icon()
    
    indicator.set_status(appindicator.IndicatorStatus.ACTIVE)
    indicator.set_menu(menu())

    gtk.main()

def set_icon():
    if os.path.exists("{}/.toggle".format(path)):
        icon = "{}/speakers.png".format(path)
    else:
        icon = "{}/headphones.png".format(path)
    indicator.set_icon(icon)

def menu():
    menu = gtk.Menu()
    ac_group = gtk.AccelGroup()
    
    menu.set_accel_group(ac_group)
    
    switch_command = gtk.MenuItem("Switch")
    
    switch_command.connect('activate', switch)
    menu.append(switch_command)
    print(switch_command.get_accel_path())
    close_command = gtk.MenuItem("Close Tray")
    close_command.connect('activate', quit)
    menu.append(close_command)
    
    menu.show_all()
    return menu

def switch(_):
    os.system("speakers.sh")
    set_icon()

def quit(_):
    gtk.main_quit()

if __name__ == "__main__":
    main()


